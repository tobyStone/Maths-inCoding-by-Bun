<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Maths questions starter</title>
    <link rel="icon" type="image/png" href="/images/linux_site_logo.jpg" sizes="32x32">
</head>

<body>
    <!-- Questions for the Geometry in Scratch Physics simulator -->
    <div>
        <form id="question-form">
            <% for (let i = 0; i < questionData.length; i++) { %>
                <% const currentQuestion = questionData[i]; %>
                <div class="question-block">
                    <img src="<%= currentQuestion.imgSrc %>" alt="<%= currentQuestion.imgAlt %>" width="525" height="350" />
                    <p><%= currentQuestion.questionText %></p>
                    <div class="choices">
                        <% for (let j = 0; j < currentQuestion.choices.length; j++) { %>
                            <input type="radio" name="answer<%= i %>" id="choice<%= i %>-<%= j %>" value="<%= j %>">
                            <label for="choice<%= i %>-<%= j %>"><%= currentQuestion.choices[j] %></label>
                        <% } %>
                    </div>
                </div>
            <% } %>
            <button type="submit">Send answer</button>
        </form>
    </div>

    <script src="/javascript/anglesGrade.js"></script>
    <script>
        const correctAnswers = [<%- JSON.stringify(questionData.map(q => q.answer)) %>];

        const questionForm = document.getElementById("question-form");
        questionForm.addEventListener("submit", function (event) {
            event.preventDefault();

            const selectedAnswers = Array.from(questionForm.querySelectorAll("input[type=radio]:checked")).map(input => Number(input.value));
            let score = 0;

            // Calculate the score
            selectedAnswers.forEach((answer, index) => {
                if (answer === correctAnswers[index]) {
                    score++;
                }
            });

            // Example redirection logic based on the score
            if (score <= questionData.length * 0.8) {
                window.location.href = 'https://corbettmaths.com/2013/05/03/sine-rule-missing-sides/';
            } else {
                const previousVideoURL = localStorage.getItem("previousVideoURL");
                const previousVideoTimestamp = localStorage.getItem("previousVideoTimestamp");
                window.location.href = previousVideoURL + '?t=' + previousVideoTimestamp;
            }
        });
    </script>
</body>
</html>
